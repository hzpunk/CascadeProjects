<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hzlab Bot Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center mb-8">ü§ñ Hzlab Bot Admin</h1>
        
        <div class="max-w-md mx-auto space-y-6">
            <!-- –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">–°—Ç–∞—Ç—É—Å –±–æ—Ç–∞</h2>
                <div id="botStatus" class="flex items-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                    <span>–ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω</span>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–æ–π -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–æ–π</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏:</label>
                        <textarea id="broadcastMessage" class="w-full bg-gray-700 rounded-lg p-3 h-24" placeholder="üöÄ Hzlab –∑–∞–ø—É—â–µ–Ω!&#10;üåê –°–∞–π—Ç: https://hzlabik.ru">üöÄ Hzlab –∑–∞–ø—É—â–µ–Ω!

üåê –°–∞–π—Ç —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω: https://hzlabik.ru

–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à–µ —Ç–µ—Ä–ø–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É! üéâ</textarea>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="sendWithImage" checked class="rounded">
                        <label for="sendWithImage">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º</label>
                    </div>
                    
                    <button onclick="sendBroadcast()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition">
                        üì¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
                    </button>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</span>
                        <span id="totalUsers" class="font-bold">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span>–ü–æ—Å–ª–µ–¥–Ω—è—è —Ä–∞—Å—Å—ã–ª–∫–∞:</span>
                        <span id="lastBroadcast" class="font-bold">-</span>
                    </div>
                </div>
            </div>

            <!-- –õ–æ–≥–∏ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                <div id="logs" class="bg-gray-900 rounded p-3 h-32 overflow-y-auto text-sm font-mono">
                    <div class="text-gray-400">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function sendBroadcast() {
            const message = document.getElementById('broadcastMessage').value;
            const withImage = document.getElementById('sendWithImage').checked;
            
            if (!message.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏');
                return;
            }

            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';

            try {
                const response = await fetch('/api/broadcast', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        withImage: withImage
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert(`‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –£—Å–ø–µ—à–Ω–æ: ${result.successful}, –û—à–∏–±–æ–∫: ${result.failed}`);
                    updateLogs(`–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${result.successful} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                } else {
                    alert(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`);
                    updateLogs(`–û—à–∏–±–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏: ${result.error}`);
                }
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
                updateLogs(`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'üì¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É';
            }
        }

        function updateLogs(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logEntry.className = 'text-green-400';
            logs.insertBefore(logEntry, logs.firstChild);
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
            while (logs.children.length > 10) {
                logs.removeChild(logs.lastChild);
            }
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                document.getElementById('totalUsers').textContent = stats.totalUsers || '-';
                document.getElementById('lastBroadcast').textContent = stats.lastBroadcast || '-';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadStats();
        updateLogs('–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    </script>
</body>
</html>
